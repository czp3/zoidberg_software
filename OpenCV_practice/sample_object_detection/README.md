currently not well commented and might be broken (moved things around without testing)- will fix later today
